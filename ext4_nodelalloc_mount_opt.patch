From: Mingming Cao <cmm@us.ibm.com>
Add a mount option to turn off delayed allocation.

Signed-off-by: Mingming Cao <cmm@us.ibm.com>
---
---
 fs/ext4/super.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

Index: linux-2.6.22/fs/ext4/super.c
===================================================================
--- linux-2.6.22.orig/fs/ext4/super.c	2007-07-16 01:00:37.000000000 -0700
+++ linux-2.6.22/fs/ext4/super.c	2007-07-16 01:00:43.000000000 -0700
@@ -737,7 +737,7 @@ enum {
 	Opt_jqfmt_vfsold, Opt_jqfmt_vfsv0, Opt_quota, Opt_noquota,
 	Opt_ignore, Opt_barrier, Opt_err, Opt_resize, Opt_usrquota,
 	Opt_grpquota, Opt_extents, Opt_noextents,
-	Opt_delayed_alloc,
+	Opt_delayed_alloc, Opt_nodelayed_alloc,
 };
 
 static match_table_t tokens = {
@@ -792,6 +792,7 @@ static match_table_t tokens = {
 	{Opt_extents, "extents"},
 	{Opt_noextents, "noextents"},
 	{Opt_delayed_alloc, "delalloc"},
+	{Opt_nodelayed_alloc, "nodelalloc"},
 	{Opt_err, NULL},
 	{Opt_resize, "resize"},
 };
@@ -1116,6 +1117,9 @@ clear_qf_name:
 		case Opt_delayed_alloc:
 			set_opt(sbi->s_mount_opt, DELAYED_ALLOC);
 			break;
+		case Opt_nodelayed_alloc:
+			clear_opt(sbi->s_mount_opt, DELAYED_ALLOC);
+			break;
 		case Opt_ignore:
 			break;
 		case Opt_resize:
