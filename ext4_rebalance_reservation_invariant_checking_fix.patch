From: Dmitry Monakhov <dmonakhov@openvz.org>

Variable "free" was declarated as __u64 so conidition (free < 0) always
false, even if free was overflowed during substraction.

Singed-off-by: Mingming Cao <cmm@us.ibm.com>
Signed-off-by: Dmitry Monakhov <dmonakhov@openvz.org>
---
 fs/ext4/balloc.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

Index: linux-2.6.22/fs/ext4/balloc.c
===================================================================
--- linux-2.6.22.orig/fs/ext4/balloc.c	2007-07-09 15:31:53.000000000 -0700
+++ linux-2.6.22/fs/ext4/balloc.c	2007-07-09 15:31:56.000000000 -0700
@@ -1909,8 +1909,8 @@ void ext4_rebalance_reservation(struct e
 			chunk = free;
 		if (rs[i].rs_reserved || i == smp_processor_id()) {
 			rs[i].rs_reserved = chunk;
+			BUG_ON(free < chunk);
 			free -= chunk;
-			BUG_ON(free < 0);
 		}
 	}
 	BUG_ON(free);
